(self["webpackChunkweb_vue3"]=self["webpackChunkweb_vue3"]||[]).push([[194],{4029:(e,t,l)=>{"use strict";l.d(t,{dE:()=>a,IK:()=>n});var s=l(1082);let a=e=>s.ZP.formatDate(new Date(e),"YYYY/MM/DD - HH:mm:ss");function o(e){let t=new Date,l=s.ZP.getDateDiff(t,e,"minutes");return 0==l?"刚刚":l<60?l+"分钟前":l<1440?s.ZP.getDateDiff(t,e,"hours")+"小时前":s.ZP.getDateDiff(t,e,"days")+"天前"}let n=e=>o(e)},8651:(e,t,l)=>{"use strict";l.d(t,{Z:()=>p});var s=l(3673),a=l(1959),o=l(9582);const n={class:"q-pa-md q-mb-lg flex flex-center"},i=(0,s.aZ)({expose:[],props:{count:{type:Number,default:1}},setup(e){const t=e,l=(0,o.tv)(),i=(0,o.yj)(),m=(0,a.qj)({current_page:1,per:12}),c=(0,s.Fl)((()=>Math.ceil(t.count/m.per)));return(0,s.YP)((()=>i.query),(()=>{i.query.page?m.current_page=parseInt(i.query.page.toString()):m.current_page=1})),(0,s.YP)((()=>m.current_page),(()=>{l.push({query:{page:m.current_page}})})),(e,t)=>{const l=(0,s.up)("q-pagination");return(0,s.wg)(),(0,s.j4)("div",n,[(0,s.Wm)(l,{class:"q-pt-lg q-my-lg",modelValue:(0,a.SU)(m).current_page,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,a.SU)(m).current_page=e),color:"primary",max:(0,a.SU)(c),"max-pages":5},null,8,["modelValue","max"])])}}});var m=l(7300),c=l(7518),r=l.n(c);const p=i;r()(i,"components",{QPagination:m.Z})},7194:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>ee});var s=l(3673),a=l(1959),o=l(2323),n=l(8651),i=l(9582),m=l(4029),c=l(1768),r=l(6395),p=l(8825);const d=(0,s.HX)("data-v-5d3271fb");(0,s.dD)("data-v-5d3271fb");const u={class:"col-md-9 col-12 q-px-md ztop2 justify-center",style:{margin:"-30px 0 0 0"}},g=(0,s.Wm)("div",{class:"shadowonly bg-white text-center q-pa-md q-mb-md"},[(0,s.Wm)("div",{class:"text-h5 text-bold text-blue-grey-8"},"树洞")],-1),q={class:"row q-px-sm"},x={class:"text-bold text-blue-grey-9"},y={class:"text-subtitle2 text-grey"},f={class:"col-10"},h={class:"col-2 q-px-sm row"},b=(0,s.Wm)("div",null,[(0,s.Uk)(" 发送 "),(0,s.Wm)("br"),(0,s.Uk)("回复 ")],-1),_={key:1,class:"text-center text-positive"},W={class:"text-bold text-blue-grey-9"},v={class:"text-subtitle2 text-grey"},w={class:"text-grey-7"},Z={class:"text-body"},U={class:"col-3 gt-xs q-my-lg q-pt-sm q-pb-none q-pl-lg"},S={class:"fbi-sticky"},k=(0,s.Uk)(" FBI WARNING"),j={class:"text-grey-14"},Q=(0,s.Wm)("div",{class:"col-12 text-left q-mb-md text-h5 text-bold"},"发布一个树洞",-1),I={class:"col-9 col-xs-12 q-gutter-sm"},V=(0,s.Uk)(" 发布 "),z={key:1,class:"text-center text-positive"};(0,s.Cn)();const D=(0,s.aZ)({expose:[],setup(e){(0,i.tv)();const t=(0,i.yj)(),l=(0,p.Z)(),D=(0,a.qj)({posts:[],count:0,edit_comment:"",edit_post:{title:null,content:null,img:null}}),Y={},P=["1. 善意待人","2. 任何人登陆后均可发布、回复树洞","3. 发布内容时请留意个人隐私信息","4. 回复仅支持换行和空格两种排版格式；树洞支持的排版格式见编辑器"];(0,s.YP)((()=>t.query),(()=>{console.log("post watch route:"),console.log(t),H()})),(0,s.bv)((()=>{H()}));const H=()=>{const e={page:t.query.page||1};c.api.get("/api/post",{params:e}).then((e=>{D.posts=e.data.results,D.count=e.data.count}))},C=e=>{let t={post:e,content:D.edit_comment,author:r.Z.getItem("uid")};c.api.post("api/reply/",t).then((e=>{l.notify("回复已发送！"),D.edit_comment="",H()})).catch((e=>{l.notify({message:"回复失败！",color:"red"})}))},K=()=>{let e={title:D.edit_post.title,content:D.edit_post.content,author:r.Z.getItem("uid"),img:D.edit_post.img};c.api.post("api/post/",e).then((e=>{l.notify("发布成功！"),D.edit_post={title:null,content:null,img:null},H()})).catch((e=>{l.notify({message:"发布失败！",color:"red"})}))};return(e,t)=>{const l=(0,s.up)("q-img"),i=(0,s.up)("q-card-section"),c=(0,s.up)("q-separator"),p=(0,s.up)("q-avatar"),H=(0,s.up)("q-space"),M=(0,s.up)("q-item-section"),A=(0,s.up)("q-chip"),F=(0,s.up)("q-input"),L=(0,s.up)("q-btn"),B=(0,s.up)("q-form"),E=(0,s.up)("q-card"),N=(0,s.up)("q-expansion-item"),T=(0,s.up)("q-list"),R=(0,s.up)("q-editor"),G=(0,s.up)("q-icon"),X=(0,s.up)("q-file"),J=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(J,{class:"row justify-center"},{default:d((()=>[(0,s.Wm)(l,{src:"https://evens-oss.oss-cn-shanghai.aliyuncs.com/img/20210618014415.jpg",style:{height:"62vh",width:"100vd",opacity:"0.95"}}),(0,s.Wm)("div",u,[g,(0,s.Wm)("div",q,[(0,s.Wm)(T,{class:"col-md-9 col-lg-9 col-sm-9 col-12"},{default:d((()=>[((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)((0,a.SU)(D).posts,(e=>((0,s.wg)(),(0,s.j4)(E,{class:"shadowonly q-my-lg q-pt-sm q-pb-none q-px-sm"},{default:d((()=>[(0,s.Wm)(i,{class:"q-py-sm q-ma-none"},{default:d((()=>[(0,s.Wm)("div",{class:"q-ma-none q-pa-none text-h5 text-bold ellipsis",title:e.title},(0,o.zw)(e.title),9,["title"])])),_:2},1024),(0,s.Wm)(c,{inset:"",class:"q-mt-xs line-1px",color:"positive"}),(0,s.Wm)(i,{class:"row items-center q-pl-md q-pt-md q-my-none text-subtitle2"},{default:d((()=>[(0,s.Wm)(p,{size:"md",class:"on-left"},{default:d((()=>[(0,s.Wm)(l,{src:e.user_avatar||"img/akari.jpg",ratio:"1","img-style":{width:"2em",height:"2em"}},null,8,["src"])])),_:2},1024),(0,s.Wm)("div",x,(0,o.zw)(e.user_nickname?e.user_nickname:"友人A"),1),(0,s.Wm)(H),(0,s.Wm)("div",y,(0,o.zw)((0,a.SU)(m.IK)(e.created)),1)])),_:2},1024),(0,s.Wm)(i,{class:"q-pb-md q-mx-md q-pt-none"},{default:d((()=>[(0,s.Wm)("div",{innerHTML:e.content,class:"q-pb-md"},null,8,["innerHTML"]),e.img?((0,s.wg)(),(0,s.j4)(l,{key:0,src:e.img},null,8,["src"])):(0,s.kq)("",!0)])),_:2},1024),(0,s.Wm)(i,null,{default:d((()=>[(0,s.Wm)(N,{style:{"z-index":"999"},"expand-icon-toggle":"","expand-separator":"",label:e.replies.length?"查看回复("+e.replies.length+") ":"暂无回复",icon:"chat","expand-icon-class":"text-positive","header-class":e.replies.length?"text-positive":"text-grey"},{header:d((()=>[(0,s.Wm)(M),(0,s.Wm)(M,{side:""},{default:d((()=>[(0,s.Wm)(A,{dense:"",color:"white","text-color":e.replies.length?"positive":"grey-5",icon:"chat",class:"q-pt-sm q-pb-xs q-pr-none q-mr-none",label:e.replies.length?" 回复("+e.replies.length+") ":" 暂无回复"},null,8,["text-color","label"])])),_:2},1024)])),default:d((()=>[(0,a.SU)(r.Z).getItem("uid")?((0,s.wg)(),(0,s.j4)(B,{key:0,onSubmit:t=>C(e.id),class:"row flex q-pb-md"},{default:d((()=>[(0,s.Wm)("div",f,[(0,s.Wm)(F,{modelValue:(0,a.SU)(D).edit_comment,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,a.SU)(D).edit_comment=e),autogrow:"",outlined:"",type:"textarea"},null,8,["modelValue"])]),(0,s.Wm)("div",h,[(0,s.Wm)(L,{unelevated:"","no-wrap":"",align:"evenly",color:"primary",class:"col-12 text-white shadowhover",type:"submit"},{default:d((()=>[b])),_:1})])])),_:2},1032,["onSubmit"])):((0,s.wg)(),(0,s.j4)("div",_," 点击顶栏头像按钮登录以进行回复 ")),((0,s.wg)(!0),(0,s.j4)(s.HY,null,(0,s.Ko)(e.replies,((e,t)=>((0,s.wg)(),(0,s.j4)(E,{square:"",flat:""},{default:d((()=>[(0,s.Wm)(i,{class:"row items-center q-pl-sm text-subtitle2"},{default:d((()=>[(0,s.Wm)(p,{size:"md",class:"on-left"},{default:d((()=>[(0,s.Wm)(l,{src:e.user_avatar||"img/akari.jpg",ratio:"1","img-style":{width:"2em",height:"2em"}},null,8,["src"])])),_:2},1024),(0,s.Wm)("div",W,(0,o.zw)(e.user_nickname?e.user_nickname:"友人A"),1),(0,s.Wm)(H),(0,s.Wm)("div",v,[(0,s.Uk)((0,o.zw)((0,a.SU)(m.IK)(e.created))+"    ",1),(0,s.Wm)("span",w,(0,o.zw)(t+1)+"楼",1)])])),_:2},1024),(0,s.Wm)(i,{id:"reply_card",class:"q-pl-xl q-py-none q-ml-xs"},{default:d((()=>[(0,s.Wm)("pre",Z,(0,o.zw)(e.content),1)])),_:2},1024),(0,s.Wm)(c,{class:"line-1px q-mt-none q-mb-md",inset:""})])),_:2},1024)))),256))])),_:2},1032,["label","header-class"])])),_:2},1024)])),_:2},1024)))),256))])),_:1}),(0,s.Wm)("div",U,[(0,s.Wm)("div",S,[(0,s.Wm)(A,{square:"",flat:"",size:"md",class:"q-mb-md q-ml-none text-white bg-red"},{default:d((()=>[k])),_:1}),((0,s.wg)(),(0,s.j4)(s.HY,null,(0,s.Ko)(P,(e=>(0,s.Wm)("p",j,(0,o.zw)(e),1))),64))])])]),(0,s.Wm)(n.Z,{count:(0,a.SU)(D).count},null,8,["count"]),Q,(0,a.SU)(r.Z).getItem("uid")?((0,s.wg)(),(0,s.j4)(B,{key:0,onSubmit:t[5]||(t[5]=e=>K()),class:"row flex q-pb-md"},{default:d((()=>[(0,s.Wm)("div",I,[(0,s.Wm)(F,{filled:"","bg-color":"white",modelValue:(0,a.SU)(D).edit_post.title,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,a.SU)(D).edit_post.title=e),label:" 标题",clearable:"","clear-icon":"clear"},null,8,["modelValue"]),(0,s.Wm)(R,{flat:"",modelValue:(0,a.SU)(D).edit_post.content,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,a.SU)(D).edit_post.content=e),definitions:Y,placeholder:"正文（此区域内可使用键盘快捷键，如 CTRL+B）"},null,8,["modelValue"]),(0,s.Wm)(X,{filled:"","bg-color":"white",modelValue:(0,a.SU)(D).edit_post.img,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,a.SU)(D).edit_post.img=e),accept:"image/*",clearable:"","clear-icon":"clear"},{prepend:d((()=>[(0,s.Wm)(G,{name:"photo"})])),_:1},8,["modelValue"]),(0,s.Wm)(L,{unelevated:"","no-wrap":"",align:"evenly",color:"primary",class:"col-12 text-white text-bold q-mt-md",type:"submit"},{default:d((()=>[V])),_:1})])])),_:1})):((0,s.wg)(),(0,s.j4)("div",z," 点击顶栏头像按钮登录以发布树洞 "))])])),_:1})}}});var Y=l(4379),P=l(4027),H=l(7011),C=l(151),K=l(5589),M=l(5869),A=l(5096),F=l(2025),L=l(4615),B=l(2035),E=l(7030),N=l(8689),T=l(4689),R=l(2165),G=l(9989),X=l(1052),J=l(4554),O=l(7518),$=l.n(O);D.__scopeId="data-v-5d3271fb";const ee=D;$()(D,"components",{QPage:Y.Z,QImg:P.Z,QList:H.Z,QCard:C.Z,QCardSection:K.Z,QSeparator:M.Z,QAvatar:A.Z,QSpace:F.Z,QExpansionItem:L.Z,QItemSection:B.Z,QChip:E.Z,QForm:N.Z,QInput:T.Z,QBtn:R.Z,QEditor:G.Z,QFile:X.Z,QIcon:J.Z})}}]);